{% extends 'cms/index.html' %}

{% block content %}

<style>
    .map-box {
        width: 100%;
        height: 20rem;
        padding: 10px;
        border: 5px solid #0f6a6e;
        background-color: rgb(161, 184, 186);
    }
</style>

<div class="container-fluid">

    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">Order Details</h1>
        <div>
            <a href="#" class="btn btn-sm btn-primary shadow-sm"><i class="fas fa-download fa-sm text-white-50"></i> Download Invoice</a>
        </div>
    </div>

    <!-- Order Details Section -->
    <div class="card bg-dark text-white shadow mb-4">
        <div class="card-body">
            <div class="row align-items-center">
                <!-- Map Box -->
                <div class="col-12 col-lg-6 mb-4 mb-lg-0">
                    <div class="map-box border rounded shadow-sm" id="map" style="height: 300px;">
                        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
                        <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
                        <script>
                            var map = L.map('map').setView([51.505, -0.09], 13);
                            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                attribution: 'Â© OpenStreetMap contributors'
                            }).addTo(map);

                            // Shop location (example coordinates)
                            var shopMarker = L.marker([51.505, -0.09]).addTo(map);
                            shopMarker.bindPopup('Shop Location').openPopup();

                            // Customer address (example coordinates)
                            var customerMarker = L.marker([51.51, -0.1]).addTo(map);
                            customerMarker.bindPopup('Delivery Address').openPopup();

                            // Draw route between points
                            var latlngs = [
                                [51.505, -0.09],
                                [51.51, -0.1]
                            ];
                            var polyline = L.polyline(latlngs, {color: 'red'}).addTo(map);
                            map.fitBounds(polyline.getBounds());
                        </script>
                    </div>
                </div>

                <!-- Order Summary -->
                <div class="col-12 col-lg-6">
                    <div class="border p-4 rounded shadow-sm">
                        <h4 class="text-warning mb-3">Order Summary</h4>
                        <p><strong>Order ID:</strong> #{{ order.id }}</p>
                        <p><strong>Order Date:</strong> {{ order.order_date }}</p>
                        <p><strong>Delivery Address:</strong> {{ order.location }}</p>
                        <div class="d-flex justify-content-start">
                            <p><strong>Status:</strong> <span class="badge badge-success mr-5">{{ order.order_status }}</span></p>
                            <p><strong>Payment:</strong> <span class="badge badge-success">{{ order.payment_status }}</span></p>
                        </div>
                        <p><strong>Total Amount:</strong> <span class="text-warning">${{ order.total_price }}</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-5 mb-2">
        <h5 class="text-center">Ordered Items</h5>
    </div>

    {% for item in order.items.all %}
        <div class="card mb-3 shadow-sm p-3">
            <div class="row no-gutters">
                <!-- Product Image -->
                <div class="col-md-4">
                    <img class="card-img img-thumbnail rounded" src="{{ item.recipe.image.url }}" alt="{{ item.title }}">
                </div>

                <!-- Product Information -->
                <div class="col-md-8">
                    <div class="card-body mx-md-5 px-md-5">
                        <h5 class="card-title text-primary">{{ item.title }}</h5>
                        <p class="card-text"><strong>Description:</strong> {{ item.description }}</p>
                        <p class="card-text"><strong>Price:</strong> <span class="text-primary">${{ item.price }}</span></p>
                        <p class="card-text"><strong>Quantity:</strong> {{ item.quantity }}</p>
                        <p class="card-text"><strong>Instructions:</strong> 
                            {{ item.recipe.instructions|safe|truncatewords:"50"|linebreaks }}</p>
                    </div>
                </div>
            </div>
        </div>
    {% empty %}
        <!-- Message if no items are found -->
        <div class="alert alert-warning text-center">
            No items found in this order.
        </div>
    {% endfor %}

    <!-- Action Buttons -->
    <div class="d-flex flex-wrap justify-content-between align-items-center mt-4">
        <div class="d-flex flex-wrap">
            <a href="#" class="btn btn-outline-dark mr-2 mb-2">
                <i class="fas fa-check"></i> Mark As Paid
            </a>
            <a href="#" class="btn btn-success mb-2">
                <i class="fas fa-dollar-sign"></i> Get Payment
            </a>
        </div>
        <div class="d-flex flex-wrap">
            <a href="{% url 'create-order' %}" class="btn btn-primary mr-2 mb-2">
                <i class="fas fa-edit"></i> Edit Order
            </a>
            <a href="#" class="btn btn-danger mb-2">
                <i class="fas fa-trash"></i> Cancel Order
            </a>
        </div>
    </div>
    
    
    

</div>


{% endblock content %}